# rules.md – TikTok Mini Games

Эти правила для ИИ-ассистента (Cursor) при работе с проектом **TikTok Mini Games**.

---

## 1. Общие принципы

1. Всегда придерживайся структуры из `spec.md`.
2. Не добавляй бэкенд, API, запросы в сеть. Проект строго **frontend-only**.
3. Мобильный опыт важнее десктопа:
   - верстка mobile-first;
   - тестируй в узком экране (375–430px ширины).
4. Используй **React + TypeScript**, без Redux и тяжелых стейт-менеджеров.
5. Не подключай UI-библиотеки (MUI, Ant, Bootstrap и т.п.) без явного указания.

---

## 2. Типы и интерфейсы

1. **Не меняй** сигнатуру:
   - `GameProps`  
   - `ControlId`  
   - `GameMeta`
2. Допускается:
   - добавлять новые значения в `ControlId`, если действительно нужно;
   - добавлять новые поля в `GameMeta`, но только если они реально используются.
3. Все игры должны экспортировать компонент вида:

   ```ts
   export const SomeGame: React.FC<GameProps> = ({ onGameOver, lastControl }) => {
     // ...
   };
Все игры обязаны вызывать onGameOver(score) при завершении.

## 3. Структура файлов
Не меняй иерархию папок без необходимости:


src/
  core/
    types.ts
    GameFeed.tsx
    GameWrapper.tsx
    ControlsPad.tsx
    gamesRegistry.tsx
  games/
    *.tsx (одна игра = один файл)
  App.tsx
  main.tsx
  styles.css
Новые игры создавай только в src/games, регистрируй их в gamesRegistry.tsx.

## 4. GameFeed
GameFeed:
отображает все игры из gamesRegistry.tsx;
использует вертикальный скролл с scroll-snap.
Каждая игра должна занимать 100% высоты экрана (100vh).
Не добавляй в GameFeed лишнюю логику (таймеры, состояние игр и т.п.). Всё состояние конкретной игры — в её собственном компоненте.

## 5. GameWrapper
GameWrapper отвечает за:
заголовок и описание игры;
вывод рекорда и последнего результата;
контейнер игры;
блок кнопок управления ControlsPad;
кнопку «Играть ещё раз».
Логика работы:
хранит bestScore в localStorage по ключу best_<game.id>;
при onGameOver(score) обновляет lastScore и bestScore;
для перезапуска игры меняет key у компонента игры.
В GameWrapper не должно быть игровой логики (движения змейки, падения блоков и т.п.).

## 6. ControlsPad
ControlsPad — единственный источник ввода управления от пользователя.
Он принимает:

type ControlsPadProps = {
  controls: ControlId[];
  onPress: (control: ControlId) => void;
};
Требования:
на мобильных использовать onTouchStart (основное событие);
для удобства на десктопе можно дублировать onMouseDown.
Логика:
если controls содержит одну кнопку (tap или action) — рендерить одну большую кнопку;
если controls содержит up/down/left/right — рисовать D-pad, как на геймбое;
для ["left", "right"] — две большие кнопки слева и справа.
ControlsPad не должен знать, как именно работает игра. Он только отправляет onPress(control).

## 7. Игровая логика
Вся логика внутри компонента игры:
таймеры (setInterval, setTimeout);
обработка lastControl;
изменение позиционирования, очков, состояний.
Минимизируй сложность:
игры — очень простые, без тяжёлых алгоритмов;
никаких глобальных сторов.
Если нужно, вместо сложных анимаций можно использовать:
requestAnimationFrame;
дискретные шаги через setInterval.

## 8. UX / дизайн
UI должен быть аккуратным, но простым:
без перегруженных градиентов и теней;
скруглённые углы, читаемый текст.
Layout экрана (каждой игры):
верх: заголовок + описание + рекорды;
середина: поле игры (растягивается, но с сохранением пропорций, если нужно);
низ: блок управления;
ещё ниже (или рядом): кнопка «Играть ещё раз».
На маленьких экранах:
не делай слишком мелкие кнопки (минимум ~48px по высоте);
текст — не меньше 12–14px.

## 9. TS, стиль и качество кода
Пиши на TypeScript, не отключай проверки типов.
Не оставляй неиспользуемые переменные и импорты.
Не дублируй логику между играми. Для общих вещей можно:
выносить вспомогательные функции рядом с игрой;
или в /core, если используется несколькими играми.
Не используй any, кроме крайних случаев, и то с комментарием, зачем он нужен.

## 10. Работа с localStorage
Доступ к localStorage только в GameWrapper.
Игры не должны напрямую использовать localStorage.
Ключи вида: best_<game.id>.

## 11. Добавление новой игры
Когда нужно добавить новую игру:
Создать новый файл в src/games/NameOfGame.tsx.
Реализовать компонент React.FC<GameProps>.
Продумать:
какие ControlId нужны;
как игра завершаетcя и какой score передаёт.
Зарегистрировать игру в gamesRegistry.tsx:
уникальный id;
понятные title и description;
указать controls.
Убедиться, что на мобильном управлять можно только через ControlsPad.

## 12. Рефакторинг
Не проводи глобальный рефакторинг сразу нескольких файлов без необходимости.
Сначала доведи до рабочего состояния основные элементы:
GameFeed,
GameWrapper,
ControlsPad,
минимум 2–3 игры.
Потом можно улучшать:
стили,
повторяющиеся фрагменты кода,
производительность.

## 13. Что делать в первую очередь
Реализовать базовые ядро:

types.ts;
gamesRegistry.tsx (с заглушками игр);
GameFeed.tsx;
GameWrapper.tsx;
ControlsPad.tsx.
Реализовать минимум 2 игры:
ClickTheCircle (самая простая, уже описана);
ReactionTime или DodgeBlocks.
Проверить:
скролл-лента работает;
игры запускаются и завершаются;
управление с экрана работает на тач-эмуляции.
Только после этого расширять список игр до 10 штук.